JSITM={LatLng:function(t,a,h,n){this.lat=t,this.lng=a,this.alt=h||0,this.precision=n||5}},JSITM.LatLng.prototype.toString=function(){function t(t,a){var h=Math.pow(10,a||0);return Math.round(t*h)/h}return t(this.lat,this.precision)+" "+t(this.lng,this.precision)},JSITM.LatLng.prototype.convertGrid=function(t,a,h){var n=t.latLngToPoint(this,0),i=h.translate(n);return a.pointToLatLng(i)},JSITM.latlngFromString=function(t){var a=new RegExp("^(-?\\d+(?:\\.\\d*)?)(?:(?:\\s*[:,]?\\s*)|\\s+)(-?\\d+(?:\\.\\d*)?)$","i"),h=t.match(a);if(h){var n=parseFloat(h[1],10),i=parseFloat(h[2],10);return new JSITM.LatLng(n,i)}throw"could not parse latlng"},JSITM.Point=function(t,a,h){this.y=a,this.x=t,this.z=h||0},JSITM.Point.prototype.toString=function(){return Math.round(this.x)+" "+Math.round(this.y)},JSITM.Translation=function(t,a,h){this.dx=t,this.dy=a,this.dz=h},JSITM.Translation.prototype.translate=function(t){return new JSITM.Point(t.x+this.dx,t.y+this.dy,t.z+this.dz)},JSITM.Translation.prototype.inverse=function(){return new JSITM.Translation(-this.dx,-this.dy,-this.dz)},JSITM.Ellipsoid=function(t,a){this.a=t,this.b=a,this.e2=(Math.pow(t,2)-Math.pow(a,2))/Math.pow(t,2)},JSITM.Ellipsoid.prototype.pointToLatLng=function(t){for(var a=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),h=Math.atan2(t.z,a*(1-this.e2));;){var n=this.a/Math.sqrt(1-this.e2*Math.pow(Math.sin(h),2)),i=Math.atan2(t.z+this.e2*n*Math.sin(h),a);if(!(1e-9<Math.abs(h-i)))break;h=i}var s=i*(180/Math.PI),M=Math.atan2(t.y,t.x)*(180/Math.PI);return new JSITM.LatLng(s,M)},JSITM.Ellipsoid.prototype.latLngToPoint=function(t){var a=t.lat*(Math.PI/180),h=t.lng*(Math.PI/180),n=this.a/Math.sqrt(1-this.e2*Math.pow(Math.sin(a),2)),i=(n+t.alt)*Math.cos(a)*Math.cos(h),s=(n+t.alt)*Math.cos(a)*Math.sin(h),M=(n*(1-this.e2)+t.alt)*Math.sin(a);return new JSITM.Point(i,s,M)},JSITM.TM=function(t,a,h,n,i,s){this.ellipsoid=t,this.e0=a,this.n0=h,this.f0=n,this.lat0=i,this.lng0=s,this.radlat0=i*(Math.PI/180),this.radlng0=s*(Math.PI/180),this.af0=t.a*n,this.bf0=t.b*n,this.e2=(Math.pow(this.af0,2)-Math.pow(this.bf0,2))/Math.pow(this.af0,2),this.n=(this.af0-this.bf0)/(this.af0+this.bf0),this.n2=this.n*this.n,this.n3=this.n2*this.n},JSITM.TM.prototype.Marc=function(t){return this.bf0*((1+this.n+5/4*this.n2+5/4*this.n3)*(t-this.radlat0)-(3*this.n+3*this.n2+21/8*this.n3)*Math.sin(t-this.radlat0)*Math.cos(t+this.radlat0)+(15/8*this.n2+15/8*this.n3)*Math.sin(2*(t-this.radlat0))*Math.cos(2*(t+this.radlat0))-35/24*this.n3*Math.sin(3*(t-this.radlat0))*Math.cos(3*(t+this.radlat0)))},JSITM.TM.prototype.InitialLat=function(t){for(var a=(t-this.n0)/this.af0+this.radlat0,h=this.Marc(a),n=(t-this.n0-h)/this.af0+a;1e-5<Math.abs(t-this.n0-h);)n=(t-this.n0-h)/this.af0+a,h=this.Marc(n),a=n;return n},JSITM.TM.prototype.unproject=function(t){var a=t.x-this.e0,h=this.InitialLat(t.y),n=this.af0/Math.sqrt(1-this.e2*Math.pow(Math.sin(h),2)),i=n*(1-this.e2)/(1-this.e2*Math.pow(Math.sin(h),2)),s=n/i-1,M=Math.tan(h)/(2*i*n),o=Math.tan(h)/(24*i*Math.pow(n,3))*(5+3*Math.pow(Math.tan(h),2)+s-9*s*Math.pow(Math.tan(h),2)),r=Math.tan(h)/(720*i*Math.pow(n,5))*(61+90*Math.pow(Math.tan(h),2)+45*Math.pow(Math.tan(h),4)),p=180/Math.PI*(h-Math.pow(a,2)*M+Math.pow(a,4)*o-Math.pow(a,6)*r),e=Math.pow(Math.cos(h),-1)/n,w=Math.pow(Math.cos(h),-1)/(6*Math.pow(n,3))*(n/i+2*Math.pow(Math.tan(h),2)),S=Math.pow(Math.cos(h),-1)/(120*Math.pow(n,5))*(5+28*Math.pow(Math.tan(h),2)+24*Math.pow(Math.tan(h),4)),f=Math.pow(Math.cos(h),-1)/(5040*Math.pow(n,7))*(61+662*Math.pow(Math.tan(h),2)+1320*Math.pow(Math.tan(h),4)+720*Math.pow(Math.tan(h),6)),I=180/Math.PI*(this.radlng0+a*e-Math.pow(a,3)*w+Math.pow(a,5)*S-Math.pow(a,7)*f);return new JSITM.LatLng(p,I)},JSITM.TM.prototype.project=function(t){var a=t.lat*(Math.PI/180),h=t.lng*(Math.PI/180),n=this.af0/Math.sqrt(1-this.e2*Math.pow(Math.sin(a),2)),i=n*(1-this.e2)/(1-this.e2*Math.pow(Math.sin(a),2)),s=n/i-1,M=h-this.radlng0,o=this.Marc(a)+this.n0,r=n/2*Math.sin(a)*Math.cos(a),p=n/24*Math.sin(a)*Math.pow(Math.cos(a),3)*(5-Math.pow(Math.tan(a),2)+9*s),e=n/720*Math.sin(a)*Math.pow(Math.cos(a),5)*(61-58*Math.pow(Math.tan(a),2)+Math.pow(Math.tan(a),4)),w=o+Math.pow(M,2)*r+Math.pow(M,4)*p+Math.pow(M,6)*e,S=n*Math.cos(a),f=n/6*Math.pow(Math.cos(a),3)*(n/i-Math.pow(Math.tan(a),2)),I=n/120*Math.pow(Math.cos(a),5)*(5-18*Math.pow(Math.tan(a),2)+Math.pow(Math.tan(a),4)+14*s-58*Math.pow(Math.tan(a),2)*s),T=this.e0+M*S+Math.pow(M,3)*f+Math.pow(M,5)*I;return new JSITM.Point(T,w,0)},JSITM.GRS80=new JSITM.Ellipsoid(6378137,6356752.31414),JSITM.WGS84=new JSITM.Ellipsoid(6378137,6356752.314245),JSITM.GRS80toWGS84=new JSITM.Translation(-48,55,52),JSITM.WGS84toGRS80=JSITM.GRS80toWGS84.inverse(),JSITM.ITM=new JSITM.TM(JSITM.GRS80,219529.584,626907.38999,1.0000067,31.734394,35.204517),JSITM.point2ItmRef=function(t,a){function h(t,a){for(var h=new String(t);h.length<a;)h="0"+h;return h}var n=a||6;n<3&&(n=3),6<n&&(n=6);var i=Math.pow(10,6-n),s=Math.round(t.x/i),M=Math.round(t.y/i);return h(s,n)+" "+h(M,n)},JSITM.itmRef2Point=function(t){var a;for(a=6;3<=a;a--){var h=new RegExp("^(\\d{"+a+"})\\s*:?\\s*(\\d{"+a+"})$","i"),n=t.match(h);if(n&&0<a){var i=Math.pow(10,6-a),s=parseInt(n[1],10)*i,M=parseInt(n[2],10)*i;return new JSITM.Point(s,M)}}throw"Could not parse reference"},JSITM.itm2gps=function(t){return this.ITM.unproject(t).convertGrid(this.GRS80,this.WGS84,this.GRS80toWGS84)},JSITM.gps2itm=function(t){var a=t.convertGrid(this.WGS84,this.GRS80,this.WGS84toGRS80);return this.ITM.project(a)},JSITM.itmRef2gps=function(t){var a=this.itmRef2Point(t);return this.itm2gps(a)},JSITM.itmRef2gpsRef=function(t){return this.itmRef2gps(t).toString()},JSITM.gpsRef2itm=function(t){var a=this.latlngFromString(t);return this.gps2itm(a)},JSITM.gpsRef2itmRef=function(t,a){return this.point2ItmRef(this.gpsRef2itm(t),a||6)};